<html>
    <head>
        <script type="text/javascript">
            (function (d) {
                window.YaGamesPrivate_MsgQueue = [];
                var send = function (cb_id, message_id, message) {
                    if (typeof YaGamesPrivate !== "undefined") {
                        YaGamesPrivate.send(cb_id, message_id, message);
                    } else {
                        YaGamesPrivate_MsgQueue.push([cb_id, message_id, message]);
                    }
                };

                var t = d.getElementsByTagName("script")[0];
                var s = d.createElement("script");
                s.src = "https://yandex.ru/games/sdk/v2";
                s.async = true;
                t.parentNode.insertBefore(s, t);
                s.onload = function () {
                    var options;
                    // {{#yagames.sdk_init_options}}
                    options = {{{yagames.sdk_init_options}}};
                    // {{/yagames.sdk_init_options}}

                    YaGames.init(options)
                        .then(function (ysdk) {
                            send(0, "init", ysdk);
                        })
                        .catch(function (err) {
                            send(0, "error", err + "");
                        });
                };
                s.onerror = function () {
                    send(0, "error", "Error loading SDK. Reload the page.");
                };
            })(document);
        </script>
    </head>
    <body>
        <script type="text/javascript">
            // {{#yagames.service_worker_url}}
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker.register("{{yagames.service_worker_url}}").then(
                    function (registration) {
                        console.log("YaGames: Service Worker registration successful with scope", registration.scope);
                    },
                    function (err) {
                        console.log("YaGames: Service Worker registration failed", err);
                    }
                );
            }
            // {{/yagames.service_worker_url}}
        </script>
    </body>
</html>
